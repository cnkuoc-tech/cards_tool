<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åœ˜æ‹†è¨‚å–®è¡¨æ ¼ç”Ÿæˆå™¨ - Ning's Card</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      padding: 10px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    h1 {
      color: #1e3c72;
      margin-bottom: 10px;
      font-size: 24px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 20px;
      font-size: 13px;
    }

    /* æ‰‹æ©Ÿå„ªåŒ– */
    @media (max-width: 768px) {
      body {
        padding: 5px;
      }

      .container {
        padding: 15px;
        border-radius: 8px;
      }

      h1 {
        font-size: 20px;
      }

      .subtitle {
        font-size: 12px;
      }

      .form-section {
        padding: 15px;
      }

      .row {
        grid-template-columns: 1fr !important;
      }

      .item-row {
        grid-template-columns: 1fr !important;
      }

      .btn {
        width: 100%;
        margin: 5px 0 !important;
      }

      .btn-secondary {
        margin-left: 0 !important;
      }

      .btn-remove {
        width: 100%;
        margin-left: 0 !important;
        margin-top: 10px;
      }

      table {
        font-size: 11px;
      }

      th, td {
        padding: 6px 4px;
      }

      input, select, textarea {
        font-size: 16px; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
      }

      h3 {
        font-size: 18px;
      }
    }

    /* å¹³æ¿å„ªåŒ– */
    @media (min-width: 769px) and (max-width: 1024px) {
      .container {
        padding: 25px;
      }

      h1 {
        font-size: 26px;
      }
    }

    .form-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #ff7b00;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .btn {
      background: linear-gradient(135deg, #ff7b00, #ff9d42);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,123,0,0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: #6c757d;
      margin-left: 10px;
    }

    .btn-add {
      background: #28a745;
      font-size: 14px;
      padding: 8px 20px;
      margin-top: 10px;
    }

    .btn-remove {
      background: #dc3545;
      font-size: 12px;
      padding: 5px 15px;
      margin-left: 10px;
    }

    .items-container {
      margin-top: 20px;
    }

    .item-row {
      display: grid;
      grid-template-columns: 2fr 1fr auto;
      gap: 10px;
      align-items: end;
      margin-bottom: 10px;
      padding: 15px;
      background: white;
      border-radius: 6px;
      border: 2px solid #e0e0e0;
    }

    .output-section {
      margin-top: 30px;
    }

    .table-output {
      overflow-x: auto;
      margin-top: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border: 1px solid #dee2e6;
      font-size: 13px;
    }

    th {
      background: #1e3c72;
      color: white;
      font-weight: 600;
    }

    td {
      background: white;
    }

    .copy-btn {
      background: #007bff;
      margin-top: 15px;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px 20px;
      border-radius: 6px;
      margin-top: 15px;
      display: none;
      border: 1px solid #c3e6cb;
    }

    .info-box {
      background: #fff3cd;
      color: #856404;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #ffc107;
    }

    .highlight {
      color: #ff7b00;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>âš¾ï¸ åœ˜æ‹†è¨‚å–®è¡¨æ ¼ç”Ÿæˆå™¨</h1>
    <p class="subtitle">Ning's Card - å¿«é€Ÿç”Ÿæˆåœ˜æ‹†è¨‚å–®è¡¨æ ¼</p>

    <div class="info-box">
      ğŸ’¡ <strong>ä½¿ç”¨èªªæ˜ï¼š</strong>æ–¹æ³•1: ç›´æ¥è²¼ä¸Šè¨‚å–®æ–‡å­—è‡ªå‹•è§£æ | æ–¹æ³•2: æ‰‹å‹•å¡«å¯«è³‡æ–™ | ç”Ÿæˆå¾Œå¯è¤‡è£½è¡¨æ ¼åˆ° admin å¾Œå°æ–°å¢
    </div>

    <div class="form-section" style="background: #e3f2fd;">
      <h3 style="margin-bottom: 15px; color: #1e3c72;">âš¡ å¿«é€Ÿè²¼ä¸Šæ¨¡å¼</h3>
      
      <div class="form-group">
        <label>é¸æ“‡æ ¼å¼</label>
        <select id="pasteFormat" style="max-width: 300px;">
          <option value="random">éš¨æ©Ÿæ¨¡å¼ (1.è¨‚è³¼äºº 2.è¨‚è³¼äºº...)</option>
          <option value="pyt">éšŠä¼æ¨™å”® (éšŠä¼\tåƒ¹æ ¼\tåå–®)</option>
        </select>
      </div>

      <div class="form-group">
        <label>è²¼ä¸Šè¨‚å–®æ–‡å­—</label>
        <textarea id="quickPaste" rows="12" placeholder="ã€éš¨æ©Ÿæ¨¡å¼ç¯„ä¾‹ã€‘
[Ning-024]2025 Topps chrome Cosmic hobby*4 random team
ä¸€æŸ±2100
1.Tttt
2.Tttt
3.è²“
4.è²“
...

ã€éšŠä¼æ¨™å”®ç¯„ä¾‹ã€‘
[Ning-025]2024 Topps Chrome Baseball PYT
éšŠä¼	åƒ¹æ ¼	åå–®
é“å¥‡	12400	éŸ‹æ©
é‹å‹•å®¶	12400	è¿·é€”å°å¡å¥´
åœ‹æ°‘	8000	éŸ‹æ©
..." style="font-family: monospace;"></textarea>
      </div>
      <button class="btn" onclick="parseQuickText()">ğŸš€ è‡ªå‹•è§£æä¸¦ç”Ÿæˆ</button>
      <button class="btn btn-secondary" onclick="document.getElementById('quickPaste').value = ''">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>

    <div style="text-align: center; margin: 20px 0; color: #999;">
      â”€â”€ æˆ–æ‰‹å‹•å¡«å¯« â”€â”€
    </div>

    <div class="form-section">
      <h3 style="margin-bottom: 20px; color: #1e3c72;">ğŸ“‹ åŸºæœ¬è³‡æ–™</h3>
      
      <div class="row">
        <div class="form-group">
          <label>è¨‚è³¼äºº *</label>
          <input type="text" id="buyer" placeholder="ä¾‹: Alex Torres">
        </div>

        <div class="form-group">
          <label>åœ˜æ‹†ç·¨è™Ÿ *</label>
          <input type="text" id="breakNumber" placeholder="ä¾‹: Ning-020">
        </div>

        <div class="form-group">
          <label>ç¨®é¡ *</label>
          <select id="category">
            <option value="æ£’çƒâš¾ï¸">æ£’çƒâš¾ï¸</option>
            <option value="ç±ƒçƒğŸ€">ç±ƒçƒğŸ€</option>
            <option value="ç¾è¶³ğŸˆ">ç¾è¶³ğŸˆ</option>
            <option value="å…¶ä»–">å…¶ä»–</option>
          </select>
        </div>
      </div>

      <div class="form-group">
        <label>åœ˜å *</label>
        <input type="text" id="breakName" placeholder="ä¾‹: 2024 bowman draft hobby jumbo *1 + 2025 bowman hobby box*1 mixer">
      </div>

      <div class="form-group">
        <label>åœ˜æ‹†å½¢å¼</label>
        <select id="breakType">
          <option value="éš¨æ©Ÿ">éš¨æ©Ÿ</option>
          <option value="PYT">PYT</option>
          <option value="æ··åˆ">æ··åˆ</option>
          <option value="å…¶ä»–">å…¶ä»–</option>
        </select>
      </div>
    </div>

    <div class="form-section">
      <h3 style="margin-bottom: 15px; color: #1e3c72;">ğŸ›’ è¨‚è³¼å“é …</h3>
      
      <div id="itemsContainer" class="items-container">
        <!-- å“é …æœƒå‹•æ…‹æ·»åŠ åˆ°é€™è£¡ -->
      </div>

      <button class="btn btn-add" onclick="addItem()">â• æ–°å¢å“é …</button>
    </div>

    <div style="margin-top: 30px; text-align: center;">
      <button class="btn" onclick="generateTable()">âœ¨ ç”Ÿæˆè¡¨æ ¼</button>
      <button class="btn btn-secondary" onclick="resetForm()">ğŸ”„ é‡ç½®</button>
    </div>

    <div class="output-section" id="outputSection" style="display: none;">
      <h3 style="color: #1e3c72; margin-bottom: 15px;">ğŸ“Š ç”Ÿæˆçµæœ</h3>
      <div class="table-output" id="tableOutput"></div>
      <button class="btn copy-btn" onclick="copyTable()">ğŸ“‹ è¤‡è£½è¡¨æ ¼</button>
      <div class="success-message" id="successMessage">âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</div>
    </div>
  </div>

  <script>
    let itemCount = 0;

    // åˆå§‹åŒ–ï¼šæ·»åŠ ä¸€å€‹é è¨­å“é …
    window.onload = function() {
      addItem();
    };

    function addItem() {
      itemCount++;
      const container = document.getElementById('itemsContainer');
      const itemDiv = document.createElement('div');
      itemDiv.className = 'item-row';
      itemDiv.id = `item-${itemCount}`;
      itemDiv.innerHTML = `
        <div class="form-group" style="margin-bottom: 0;">
          <label>å“é …åç¨± *</label>
          <input type="text" class="item-name" placeholder="ä¾‹: éš¨æ©Ÿ-å£«é “å¤§å…¨äºº">
        </div>
        <div class="form-group" style="margin-bottom: 0;">
          <label>é‡‘é¡ (NT$) *</label>
          <input type="number" class="item-price" placeholder="1200" min="0">
        </div>
        <div>
          <button class="btn btn-remove" onclick="removeItem(${itemCount})">ğŸ—‘ï¸ ç§»é™¤</button>
        </div>
      `;
      container.appendChild(itemDiv);
    }

    function removeItem(id) {
      const item = document.getElementById(`item-${id}`);
      if (item) {
        item.remove();
      }
      // å¦‚æœæ²’æœ‰å“é …äº†ï¼Œè‡ªå‹•æ·»åŠ ä¸€å€‹
      const remaining = document.querySelectorAll('.item-row').length;
      if (remaining === 0) {
        addItem();
      }
    }

    function resetForm() {
      if (confirm('ç¢ºå®šè¦é‡ç½®æ‰€æœ‰å…§å®¹å—ï¼Ÿ')) {
        document.getElementById('buyer').value = '';
        document.getElementById('breakNumber').value = '';
        document.getElementById('category').value = 'æ£’çƒâš¾ï¸';
        document.getElementById('breakName').value = '';
        document.getElementById('breakType').value = 'éš¨æ©Ÿ';
        document.getElementById('itemsContainer').innerHTML = '';
        document.getElementById('outputSection').style.display = 'none';
        document.getElementById('quickPaste').value = '';
        itemCount = 0;
        addItem();
      }
    }

    function parseQuickText() {
      const text = document.getElementById('quickPaste').value.trim();
      const format = document.getElementById('pasteFormat').value;
      
      if (!text) {
        alert('è«‹è²¼ä¸Šè¨‚å–®æ–‡å­—ï¼');
        return;
      }

      if (format === 'random') {
        parseRandomFormat(text);
      } else if (format === 'pyt') {
        parsePYTFormat(text);
      }
    }

    function parsePYTFormat(text) {
      const lines = text.split('\n').map(line => line.trim()).filter(line => line);
      
      if (lines.length < 3) {
        alert('æ ¼å¼ä¸æ­£ç¢ºï¼è«‹ç¢ºèªåŒ…å«: [ç·¨è™Ÿ]åœ˜å å’Œ éšŠä¼è³‡æ–™');
        return;
      }

      // è§£æç¬¬ä¸€è¡Œ: [Ning-025]2024 Topps Chrome Baseball PYT
      const firstLine = lines[0];
      const breakNumberMatch = firstLine.match(/\[([^\]]+)\]/);
      const breakNumber = breakNumberMatch ? breakNumberMatch[1] : '';
      const breakName = firstLine.replace(/\[[^\]]+\]/, '').trim();
      
      const breakType = 'PYT';
      const category = 'æ£’çƒâš¾ï¸';

      // æ‰¾åˆ°è¡¨æ ¼é–‹å§‹çš„ä½ç½®ï¼ˆè·³éæ¨™é¡Œè¡Œ "éšŠä¼ åƒ¹æ ¼ åå–®"ï¼‰
      let dataStartIndex = 1;
      for (let i = 1; i < lines.length; i++) {
        if (lines[i].includes('éšŠä¼') && lines[i].includes('åƒ¹æ ¼')) {
          dataStartIndex = i + 1;
          break;
        }
      }

      // è§£ææ¯ä¸€è¡ŒéšŠä¼è³‡æ–™
      const tableData = [];
      for (let i = dataStartIndex; i < lines.length; i++) {
        const line = lines[i];
        // åˆ†å‰²å¯èƒ½æ˜¯ Tab æˆ–å¤šå€‹ç©ºæ ¼
        const parts = line.split(/\t+|\s{2,}/).filter(p => p);
        
        if (parts.length >= 3) {
          const team = parts[0].trim();
          const price = parseInt(parts[1].replace(/,/g, ''));
          const buyer = parts[2].trim();
          
          if (team && !isNaN(price) && buyer) {
            tableData.push({
              buyer: buyer,
              breakNumber: breakNumber,
              category: category,
              breakName: breakName,
              breakType: breakType,
              itemName: `PYT-${team}`,
              totalPrice: price
            });
          }
        }
      }

      if (tableData.length === 0) {
        alert('æ‰¾ä¸åˆ°æœ‰æ•ˆçš„éšŠä¼è³‡æ–™ï¼è«‹ç¢ºèªæ ¼å¼ç‚º: éšŠä¼ [Tab] åƒ¹æ ¼ [Tab] åå–®');
        return;
      }

      // åˆä½µåŒä¸€å€‹è¨‚è³¼äººçš„å¤šå€‹éšŠä¼
      const buyerData = {};
      tableData.forEach(data => {
        if (!buyerData[data.buyer]) {
          buyerData[data.buyer] = {
            buyer: data.buyer,
            breakNumber: data.breakNumber,
            category: data.category,
            breakName: data.breakName,
            breakType: data.breakType,
            teams: [],
            totalPrice: 0
          };
        }
        const teamName = data.itemName.replace('PYT-', '');
        buyerData[data.buyer].teams.push(teamName);
        buyerData[data.buyer].totalPrice += data.totalPrice;
      });

      // è½‰æ›ç‚ºæœ€çµ‚è¡¨æ ¼æ ¼å¼
      const finalTableData = [];
      for (const buyer in buyerData) {
        const data = buyerData[buyer];
        const teamsText = data.teams.join('ã€');
        finalTableData.push({
          buyer: data.buyer,
          breakNumber: data.breakNumber,
          category: data.category,
          breakName: data.breakName,
          breakType: data.breakType,
          itemName: `PYT-${teamsText}`,
          totalPrice: data.totalPrice
        });
      }

      generateTableFromData(finalTableData);
    }

    function parseRandomFormat(text) {
      const lines = text.split('\n').map(line => line.trim()).filter(line => line);
      
      if (lines.length < 3) {
        alert('æ ¼å¼ä¸æ­£ç¢ºï¼è«‹ç¢ºèªåŒ…å«: [ç·¨è™Ÿ]åœ˜åã€ä¸€æŸ±é‡‘é¡ã€è¨‚è³¼äººåˆ—è¡¨');
        return;
      }

      // è§£æç¬¬ä¸€è¡Œ: [Ning-024]2025 Topps chrome Cosmic hobby*4 random team
      const firstLine = lines[0];
      const breakNumberMatch = firstLine.match(/\[([^\]]+)\]/);
      const breakNumber = breakNumberMatch ? breakNumberMatch[1] : '';
      const breakName = firstLine.replace(/\[[^\]]+\]/, '').trim();
      
      // åˆ¤æ–·åœ˜æ‹†å½¢å¼
      let breakType = 'éš¨æ©Ÿ';
      const lowerName = breakName.toLowerCase();
      if (lowerName.includes('random') || breakName.includes('éš¨æ©Ÿ')) {
        breakType = 'éš¨æ©Ÿ';
      } else if (lowerName.includes('pyt') || breakName.includes('æ¨™å”®')) {
        breakType = 'PYT';
      }

      // è§£æç¬¬äºŒè¡Œ: ä¸€æŸ±2100
      const priceLine = lines[1];
      const priceMatch = priceLine.match(/(\d+)/);
      const pricePerSlot = priceMatch ? parseInt(priceMatch[1]) : 0;

      if (!pricePerSlot) {
        alert('ç„¡æ³•è§£æé‡‘é¡ï¼è«‹ç¢ºèªç¬¬äºŒè¡Œæ ¼å¼å¦‚: ä¸€æŸ±2100');
        return;
      }

      // è§£æè¨‚è³¼äººåˆ—è¡¨: 1.Tttt, 2.Tttt, 3.è²“...
      const buyers = [];
      for (let i = 2; i < lines.length; i++) {
        const line = lines[i];
        const match = line.match(/^\d+\.(.+)$/);
        if (match) {
          buyers.push(match[1].trim());
        }
      }

      if (buyers.length === 0) {
        alert('æ‰¾ä¸åˆ°è¨‚è³¼äººï¼è«‹ç¢ºèªæ ¼å¼å¦‚: 1.è¨‚è³¼äººåç¨±');
        return;
      }

      // çµ±è¨ˆæ¯å€‹è¨‚è³¼äººçš„æ•¸é‡
      const buyerCounts = {};
      buyers.forEach(buyer => {
        buyerCounts[buyer] = (buyerCounts[buyer] || 0) + 1;
      });

      // ç”Ÿæˆè¡¨æ ¼æ•¸æ“š
      const tableData = [];
      for (const [buyer, count] of Object.entries(buyerCounts)) {
        const itemName = `éš¨æ©Ÿ-${count}æŸ±`;
        const totalPrice = pricePerSlot * count;
        tableData.push({
          buyer: buyer,
          breakNumber: breakNumber,
          category: 'æ£’çƒâš¾ï¸',
          breakName: breakName,
          breakType: breakType,
          itemName: itemName,
          totalPrice: totalPrice
        });
      }

      generateTableFromData(tableData);
    }

    function generateTableFromData(tableData) {
      if (tableData.length === 0) {
        alert('æ²’æœ‰è³‡æ–™å¯ä»¥ç”Ÿæˆï¼');
        return;
      }

      // ç”Ÿæˆè¡¨æ ¼ HTML
      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>è¨‚è³¼äºº</th>
              <th>åœ˜æ‹†ç·¨è™Ÿ</th>
              <th>ç¨®é¡</th>
              <th>åœ˜å</th>
              <th>åœ˜æ‹†å½¢å¼</th>
              <th>è³¼è²·å“é …</th>
              <th>ç¸½é‡‘é¡</th>
              <th>å·²ä»˜é‡‘é¡</th>
              <th>æ˜¯å¦å·²ä»˜</th>
              <th>å¡ç‰‡æ˜¯å¦å¯„å‡º</th>
            </tr>
          </thead>
          <tbody>
      `;

      // ç‚ºæ¯å€‹è¨‚è³¼äººç”Ÿæˆä¸€è¡Œ
      tableData.forEach(data => {
        tableHTML += `
          <tr>
            <td>${data.buyer}</td>
            <td>${data.breakNumber}</td>
            <td>${data.category}</td>
            <td>${data.breakName}</td>
            <td>${data.breakType}</td>
            <td>${data.itemName}</td>
            <td>${data.totalPrice}</td>
            <td>0</td>
            <td>N</td>
            <td>N</td>
          </tr>
        `;
      });

      tableHTML += `
          </tbody>
        </table>
      `;

      // é¡¯ç¤ºçµæœ
      document.getElementById('tableOutput').innerHTML = tableHTML;
      document.getElementById('outputSection').style.display = 'block';
      
      // ä¿å­˜æ•¸æ“šä»¥ä¾›è¤‡è£½ä½¿ç”¨
      window.currentTableData = tableData;
      
      // æ»¾å‹•åˆ°çµæœå€åŸŸ
      document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
    }

    function generateTable() {
      // ç²å–åŸºæœ¬è³‡æ–™
      const buyer = document.getElementById('buyer').value.trim();
      const breakNumber = document.getElementById('breakNumber').value.trim();
      const category = document.getElementById('category').value;
      const breakName = document.getElementById('breakName').value.trim();
      const breakType = document.getElementById('breakType').value;

      // é©—è­‰å¿…å¡«æ¬„ä½
      if (!buyer || !breakNumber || !breakName) {
        alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼ˆè¨‚è³¼äººã€åœ˜æ‹†ç·¨è™Ÿã€åœ˜åï¼‰ï¼');
        return;
      }

      // ç²å–æ‰€æœ‰å“é …
      const items = [];
      const itemRows = document.querySelectorAll('.item-row');
      
      itemRows.forEach((row, index) => {
        const name = row.querySelector('.item-name').value.trim();
        const price = row.querySelector('.item-price').value.trim();
        
        if (name && price) {
          items.push({
            name: name,
            price: parseInt(price)
          });
        }
      });

      if (items.length === 0) {
        alert('è«‹è‡³å°‘æ·»åŠ ä¸€å€‹è¨‚è³¼å“é …ï¼');
        return;
      }

      // è¨ˆç®—ç¸½é‡‘é¡
      const totalPrice = items.reduce((sum, item) => sum + item.price, 0);

      // ç”Ÿæˆè¡¨æ ¼ HTML
      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>è¨‚è³¼äºº</th>
              <th>åœ˜æ‹†ç·¨è™Ÿ</th>
              <th>ç¨®é¡</th>
              <th>åœ˜å</th>
              <th>åœ˜æ‹†å½¢å¼</th>
              <th>è³¼è²·å“é …</th>
              <th>ç¸½é‡‘é¡</th>
              <th>å·²ä»˜é‡‘é¡</th>
              <th>æ˜¯å¦å·²ä»˜</th>
              <th>å¡ç‰‡æ˜¯å¦å¯„å‡º</th>
            </tr>
          </thead>
          <tbody>
      `;

      // ç‚ºæ¯å€‹å“é …ç”Ÿæˆä¸€è¡Œ
      items.forEach((item, index) => {
        const isFirstRow = index === 0;
        const rowspan = items.length;

        tableHTML += '<tr>';
        
        if (isFirstRow) {
          tableHTML += `<td rowspan="${rowspan}">${buyer}</td>`;
          tableHTML += `<td rowspan="${rowspan}">${breakNumber}</td>`;
          tableHTML += `<td rowspan="${rowspan}">${category}</td>`;
          tableHTML += `<td rowspan="${rowspan}">${breakName}</td>`;
          tableHTML += `<td rowspan="${rowspan}">${breakType}</td>`;
        }
        
        tableHTML += `<td>${item.name}</td>`;
        
        if (isFirstRow) {
          tableHTML += `<td rowspan="${rowspan}">${totalPrice}</td>`;
          tableHTML += `<td rowspan="${rowspan}">0</td>`;
          tableHTML += `<td rowspan="${rowspan}">N</td>`;
          tableHTML += `<td rowspan="${rowspan}">N</td>`;
        }
        
        tableHTML += '</tr>';
      });

      tableHTML += `
          </tbody>
        </table>
      `;

      // é¡¯ç¤ºçµæœ
      document.getElementById('tableOutput').innerHTML = tableHTML;
      document.getElementById('outputSection').style.display = 'block';
      
      // æ»¾å‹•åˆ°çµæœå€åŸŸ
      document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
    }

    async function copyTable() {
      // æª¢æŸ¥æ˜¯å¦æœ‰å¿«é€Ÿæ¨¡å¼çš„æ•¸æ“š
      if (window.currentTableData && window.currentTableData.length > 0) {
        // ä½¿ç”¨å¿«é€Ÿæ¨¡å¼çš„æ•¸æ“š
        let tsvData = '';
        
        window.currentTableData.forEach(data => {
          tsvData += `${data.buyer}\t${data.breakNumber}\t${data.category}\t${data.breakName}\t${data.breakType}\t${data.itemName}\t${data.totalPrice}\t0\tN\tN\n`;
        });

        try {
          await navigator.clipboard.writeText(tsvData);
          const successMsg = document.getElementById('successMessage');
          successMsg.style.display = 'block';
          setTimeout(() => {
            successMsg.style.display = 'none';
          }, 3000);
        } catch (err) {
          alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–è¡¨æ ¼å…§å®¹è¤‡è£½');
        }
        return;
      }

      // åŸæœ¬çš„æ‰‹å‹•æ¨¡å¼è¤‡è£½é‚è¼¯
      const buyer = document.getElementById('buyer').value.trim();
      const breakNumber = document.getElementById('breakNumber').value.trim();
      const category = document.getElementById('category').value;
      const breakName = document.getElementById('breakName').value.trim();
      const breakType = document.getElementById('breakType').value;

      // ç²å–æ‰€æœ‰å“é …
      const items = [];
      const itemRows = document.querySelectorAll('.item-row');
      
      itemRows.forEach(row => {
        const name = row.querySelector('.item-name').value.trim();
        const price = row.querySelector('.item-price').value.trim();
        
        if (name && price) {
          items.push({
            name: name,
            price: parseInt(price)
          });
        }
      });

      const totalPrice = items.reduce((sum, item) => sum + item.price, 0);

      // ç”Ÿæˆ TSV æ ¼å¼ï¼ˆç”¨ Tab åˆ†éš”ï¼Œå¯ç›´æ¥è²¼åˆ° Google Sheetsï¼‰
      let tsvData = '';
      
      items.forEach((item, index) => {
        if (index === 0) {
          // ç¬¬ä¸€è¡ŒåŒ…å«æ‰€æœ‰åˆä½µçš„æ¬„ä½
          tsvData += `${buyer}\t${breakNumber}\t${category}\t${breakName}\t${breakType}\t${item.name}\t${totalPrice}\t0\tN\tN\n`;
        } else {
          // å¾ŒçºŒè¡Œåªæœ‰å“é …åç¨±
          tsvData += `\t\t\t\t\t${item.name}\t\t\t\t\n`;
        }
      });

      try {
        await navigator.clipboard.writeText(tsvData);
        const successMsg = document.getElementById('successMessage');
        successMsg.style.display = 'block';
        setTimeout(() => {
          successMsg.style.display = 'none';
        }, 3000);
      } catch (err) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–è¡¨æ ¼å…§å®¹è¤‡è£½');
      }
    }
  </script>
</body>
</html>
