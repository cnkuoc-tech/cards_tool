<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Topps Now ç”¢å“è¡¨æ ¼ç”Ÿæˆå™¨ - Ning's Card</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      padding: 10px;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }

    h1 {
      color: #1e3c72;
      margin-bottom: 10px;
      font-size: 24px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 20px;
      font-size: 13px;
    }

    /* æ‰‹æ©Ÿå„ªåŒ– */
    @media (max-width: 768px) {
      body {
        padding: 5px;
      }

      .container {
        padding: 15px;
        border-radius: 8px;
      }

      h1 {
        font-size: 20px;
      }

      .subtitle {
        font-size: 12px;
      }

      .form-section {
        padding: 15px;
      }

      .row {
        grid-template-columns: 1fr !important;
      }

      .btn {
        width: 100%;
        margin: 5px 0 !important;
      }

      .btn-secondary {
        margin-left: 0 !important;
      }

      table {
        font-size: 11px;
      }

      th, td {
        padding: 6px 4px;
      }

      .product-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .product-item {
        padding: 15px;
      }

      input, select, textarea {
        font-size: 16px; /* é˜²æ­¢ iOS è‡ªå‹•ç¸®æ”¾ */
      }
    }

    /* å¹³æ¿å„ªåŒ– */
    @media (min-width: 769px) and (max-width: 1024px) {
      .container {
        padding: 25px;
      }

      h1 {
        font-size: 26px;
      }
    }

    .form-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #333;
      font-weight: 600;
      font-size: 14px;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #ff7b00;
    }

    .row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    .btn {
      background: linear-gradient(135deg, #ff7b00, #ff9d42);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 6px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255,123,0,0.3);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .btn-secondary {
      background: #6c757d;
      margin-left: 10px;
    }

    .btn-add {
      background: #28a745;
      font-size: 14px;
      padding: 8px 20px;
      margin-top: 10px;
    }

    .btn-remove {
      background: #dc3545;
      font-size: 12px;
      padding: 5px 15px;
    }

    .product-item {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 15px;
    }

    .product-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    .product-number {
      background: #1e3c72;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-weight: 600;
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }

    .spinner {
      border: 3px solid #f3f3f3;
      border-top: 3px solid #ff7b00;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .output-section {
      margin-top: 30px;
    }

    .table-output {
      overflow-x: auto;
      margin-top: 15px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      font-size: 13px;
    }

    th, td {
      padding: 10px 8px;
      text-align: center;
      border: 1px solid #dee2e6;
    }

    th {
      background: #1e3c72;
      color: white;
      font-weight: 600;
      white-space: nowrap;
    }

    td {
      background: white;
    }

    .copy-btn {
      background: #007bff;
      margin-top: 15px;
    }

    .success-message {
      background: #d4edda;
      color: #155724;
      padding: 12px 20px;
      border-radius: 6px;
      margin-top: 15px;
      display: none;
      border: 1px solid #c3e6cb;
    }

    .error-message {
      background: #f8d7da;
      color: #721c24;
      padding: 12px 20px;
      border-radius: 6px;
      margin-top: 15px;
      border: 1px solid #f5c6cb;
    }

    .info-box {
      background: #fff3cd;
      color: #856404;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #ffc107;
    }

    .warning-box {
      background: #f8d7da;
      color: #721c24;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      border-left: 4px solid #dc3545;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>âš¾ï¸ Topps Now ç”¢å“è¡¨æ ¼ç”Ÿæˆå™¨</h1>
    <p class="subtitle">Ning's Card - è‡ªå‹•æŠ“å– Topps Now ç”¢å“è³‡æ–™ä¸¦è¨ˆç®—åƒ¹æ ¼</p>

    <div class="info-box">
      ğŸ’¡ <strong>ä½¿ç”¨èªªæ˜ï¼š</strong>è²¼ä¸Š Topps.com çš„ç”¢å“ç¶²å€ï¼Œç³»çµ±æœƒè‡ªå‹•æŠ“å–å¡è™Ÿã€çƒå“¡ã€åƒ¹æ ¼ç­‰è³‡è¨Šä¸¦è¨ˆç®—å°å¹£å”®åƒ¹
    </div>

    <div class="warning-box">
      âš ï¸ <strong>æ³¨æ„ï¼š</strong>ç”±æ–¼ç€è¦½å™¨å®‰å…¨é™åˆ¶ï¼Œè‡ªå‹•æŠ“å–åŠŸèƒ½å¯èƒ½ç„¡æ³•ä½¿ç”¨ã€‚è«‹æ”¹ç”¨æ‰‹å‹•è¼¸å…¥æ¨¡å¼ã€‚
    </div>

    <div class="form-section">
      <h3 style="margin-bottom: 20px; color: #1e3c72;">âš™ï¸ åŸºæœ¬è¨­å®š</h3>
      
      <div class="row">
        <div class="form-group">
          <label>ç¾é‡‘åŒ¯ç‡ *</label>
          <input type="number" id="exchangeRate" value="32.5" step="0.1" placeholder="32.5">
        </div>
      </div>
    </div>

    <div class="form-section" style="background: #e3f2fd;">
      <h3 style="margin-bottom: 15px; color: #1e3c72;">â• æ–°å¢ç”¢å“</h3>
      
      <div class="form-group">
        <label>ğŸ“¸ ä¸Šå‚³ç”¢å“é é¢æˆªåœ– (è‡ªå‹•è­˜åˆ¥)</label>
        <input type="file" id="imageUpload" accept="image/*" onchange="handleImageUpload(event)" style="padding: 8px;">
        <small style="color: #666; display: block; margin-top: 5px;">æ”¯æ´ JPG, PNG æ ¼å¼ã€‚æˆªåœ–æ‡‰åŒ…å«å¡è™Ÿã€çƒå“¡åç¨±ã€åƒ¹æ ¼è³‡è¨Š</small>
      </div>

      <div id="imagePreview" style="margin: 15px 0; display: none;">
        <img id="previewImg" style="max-width: 100%; max-height: 300px; border-radius: 8px; border: 2px solid #e0e0e0;">
        <div id="ocrStatus" style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; display: none;">
          <div class="spinner"></div>
          <p style="text-align: center; margin-top: 10px;">æ­£åœ¨è­˜åˆ¥åœ–ç‰‡å…§å®¹...</p>
        </div>
      </div>

      <div style="text-align: center; margin: 15px 0; color: #999;">
        â”€â”€ æˆ–æ‰‹å‹•è¼¸å…¥ â”€â”€
      </div>

      <div class="form-group">
        <label>Topps.com ç”¢å“ç¶²å€</label>
        <input type="text" id="productUrl" placeholder="https://www.topps.com/products/...">
      </div>

      <div class="row">
        <div class="form-group">
          <label>å¡è™Ÿï¼ˆä¾‹: 89ï¼‰</label>
          <input type="text" id="cardNumber" placeholder="89">
        </div>
        <div class="form-group">
          <label>5å¼µå–®åƒ¹ USDï¼ˆæ¯å¼µåƒ¹æ ¼ï¼‰</label>
          <input type="number" id="price5" placeholder="8.00" step="0.01">
        </div>
        <div class="form-group">
          <label>10å¼µå–®åƒ¹ USDï¼ˆæ¯å¼µåƒ¹æ ¼ï¼‰</label>
          <input type="number" id="price10" placeholder="7.00" step="0.01">
        </div>
      </div>

      <div class="form-group">
        <label>å“é …åç¨±ï¼ˆçƒå“¡å - äº‹ä»¶æè¿°ï¼‰</label>
        <input type="text" id="itemName" placeholder="Aaron Judge - é€†è½‰ä¸‰åˆ†ç ²">
      </div>

      <div class="row">
        <div class="form-group">
          <label>å¯æŠ½_SP</label>
          <select id="canDrawSP">
            <option value="N">N</option>
            <option value="Y">Y</option>
          </select>
        </div>
        <div class="form-group">
          <label>å¯æŠ½_ç°½å</label>
          <select id="canDrawAuto">
            <option value="N">N</option>
            <option value="Y">Y</option>
          </select>
        </div>
        <div class="form-group">
          <label>å¯æŠ½_Relic</label>
          <select id="canDrawRelic">
            <option value="N">N</option>
            <option value="Y">Y</option>
          </select>
        </div>
        <div class="form-group">
          <label>æŠ½_auto_relic</label>
          <select id="autoRelic">
            <option value="N">N</option>
            <option value="Y">Y</option>
          </select>
        </div>
      </div>

      <button class="btn" onclick="addProduct()">â• åŠ å…¥ç”¢å“åˆ—è¡¨</button>
      <button class="btn btn-secondary" onclick="fetchFromUrl()">ğŸ”„ å¾ç¶²å€è‡ªå‹•å¡«å…¥</button>
    </div>

    <div id="productsList" style="margin-top: 20px;">
      <!-- ç”¢å“åˆ—è¡¨æœƒé¡¯ç¤ºåœ¨é€™è£¡ -->
    </div>

    <div style="margin-top: 30px; text-align: center;" id="generateSection" style="display: none;">
      <button class="btn" onclick="generateTable()">âœ¨ ç”Ÿæˆè¡¨æ ¼</button>
      <button class="btn btn-secondary" onclick="resetAll()">ğŸ”„ å…¨éƒ¨é‡ç½®</button>
    </div>

    <div class="output-section" id="outputSection" style="display: none;">
      <h3 style="color: #1e3c72; margin-bottom: 15px;">ğŸ“Š ç”Ÿæˆçµæœ</h3>
      <div class="table-output" id="tableOutput"></div>
      <button class="btn copy-btn" onclick="copyTable()">ğŸ“‹ è¤‡è£½è¡¨æ ¼</button>
      <div class="success-message" id="successMessage">âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼</div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4/dist/tesseract.min.js"></script>
  <script>
    let products = [];
    let productIdCounter = 0;

    async function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;

      // é¡¯ç¤ºé è¦½
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.getElementById('imagePreview');
        const img = document.getElementById('previewImg');
        img.src = e.target.result;
        preview.style.display = 'block';
        
        // é–‹å§‹ OCR
        performOCR(e.target.result);
      };
      reader.readAsDataURL(file);
    }

    async function performOCR(imageSrc) {
      const statusDiv = document.getElementById('ocrStatus');
      statusDiv.style.display = 'block';
      statusDiv.innerHTML = '<div class="spinner"></div><p style="text-align: center; margin-top: 10px;">æ­£åœ¨è­˜åˆ¥åœ–ç‰‡å…§å®¹...</p>';

      try {
        const result = await Tesseract.recognize(imageSrc, 'eng', {
          logger: m => {
            if (m.status === 'recognizing text') {
              const progress = Math.round(m.progress * 100);
              statusDiv.innerHTML = `<div class="spinner"></div><p style="text-align: center; margin-top: 10px;">è­˜åˆ¥ä¸­... ${progress}%</p>`;
            }
          }
        });

        const text = result.data.text;
        console.log('OCR Result:', text);
        
        // è§£ææ–‡å­—å…§å®¹
        parseOCRText(text);
        
        statusDiv.style.display = 'none';
        statusDiv.innerHTML = '<p style="text-align: center; color: #28a745;">âœ… è­˜åˆ¥å®Œæˆï¼è«‹ç¢ºèªä¸¦è£œå……è³‡æ–™</p>';
        setTimeout(() => {
          statusDiv.style.display = 'none';
        }, 3000);

      } catch (error) {
        console.error('OCR Error:', error);
        statusDiv.innerHTML = '<p style="text-align: center; color: #dc3545;">âŒ è­˜åˆ¥å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥</p>';
        setTimeout(() => {
          statusDiv.style.display = 'none';
        }, 3000);
      }
    }

    function parseOCRText(text) {
      console.log('=== OCR åŸå§‹æ–‡å­— ===');
      console.log(text);
      console.log('==================');
      
      const lines = text.split('\n').map(line => line.trim()).filter(line => line);
      
      // ğŸ” æå–çƒå“¡åç¨±å’Œå¡è™Ÿ (é€šå¸¸åœ¨æ¨™é¡Œè¡Œï¼Œæ ¼å¼: "çƒå“¡å - å¹´ä»½-è³½å­£ NBA Topps NOWÂ® - Card å¡è™Ÿ")
      let playerName = '';
      let cardNumber = '';
      
      for (const line of lines) {
        // åŒ¹é… "Stephen Curry - 2025-26 NBA Topps NOWÂ® - Card 101" é€™ç¨®æ ¼å¼
        const titleMatch = line.match(/^(.+?)\s*-\s*\d{4}-\d{2}\s+(?:NBA|MLB)?\s*Topps\s*NOW.*?(?:Card\s*)?(\d+)$/i);
        if (titleMatch) {
          playerName = titleMatch[1].trim();
          cardNumber = titleMatch[2];
          console.log('âœ… æ‰¾åˆ°æ¨™é¡Œ:', playerName, 'å¡è™Ÿ:', cardNumber);
          break;
        }
        
        // å‚™ç”¨: åªåŒ¹é… Card æ•¸å­—
        if (!cardNumber) {
          const cardMatch = line.match(/Card\s*(\d+)/i);
          if (cardMatch) {
            cardNumber = cardMatch[1];
            console.log('âœ… æ‰¾åˆ°å¡è™Ÿ:', cardNumber);
          }
        }
        
        // å‚™ç”¨: æå–å¯èƒ½çš„çƒå“¡åç¨± (åŒ…å«è‹±æ–‡å­—æ¯å’Œç©ºæ ¼ï¼Œé•·åº¦é©ä¸­)
        if (!playerName && line.match(/^[A-Za-z\s\-]{5,50}$/) && !line.toLowerCase().includes('topps') && !line.toLowerCase().includes('nba')) {
          playerName = line;
          console.log('âœ… å¯èƒ½çš„çƒå“¡å:', playerName);
        }
      }
      
      if (cardNumber) {
        document.getElementById('cardNumber').value = cardNumber;
      }
      if (playerName) {
        document.getElementById('itemName').value = playerName;
      }

      // ğŸ” è§£æåƒ¹æ ¼ - é‡é»æŠ“å– "/ea" (æ¯å¼µå–®åƒ¹)
      let price5 = null;
      let price10 = null;
      
      for (const line of lines) {
        // åŒ¹é… "5 cards $39.99 $8.00/ea" é€™ç¨®æ ¼å¼
        const cards5Match = line.match(/5\s*cards?\s*.*?\$(\d+\.?\d*)\s*\/\s*ea/i);
        if (cards5Match) {
          price5 = parseFloat(cards5Match[1]);
          console.log('âœ… 5å¼µå–®åƒ¹:', price5);
        }
        
        // åŒ¹é… "10 cards $69.99 $7.00/ea" é€™ç¨®æ ¼å¼
        const cards10Match = line.match(/10\s*cards?\s*.*?\$(\d+\.?\d*)\s*\/\s*ea/i);
        if (cards10Match) {
          price10 = parseFloat(cards10Match[1]);
          console.log('âœ… 10å¼µå–®åƒ¹:', price10);
        }
        
        // å‚™ç”¨: åªæœ‰ "5 cards" å’Œåƒ¹æ ¼çš„æƒ…æ³
        if (!price5 && line.includes('5') && (line.includes('card') || line.includes('SAVE'))) {
          const priceMatch = line.match(/\$(\d+\.?\d*)\s*\/\s*ea/i);
          if (priceMatch) {
            price5 = parseFloat(priceMatch[1]);
            console.log('âœ… å‚™ç”¨5å¼µå–®åƒ¹:', price5);
          }
        }
        
        if (!price10 && line.includes('10') && (line.includes('card') || line.includes('SAVE'))) {
          const priceMatch = line.match(/\$(\d+\.?\d*)\s*\/\s*ea/i);
          if (priceMatch) {
            price10 = parseFloat(priceMatch[1]);
            console.log('âœ… å‚™ç”¨10å¼µå–®åƒ¹:', price10);
          }
        }
      }
      
      if (price5) document.getElementById('price5').value = price5.toFixed(2);
      if (price10) document.getElementById('price10').value = price10.toFixed(2);

      // æª¢æŸ¥æ˜¯å¦æåˆ°ç‰¹æ®Šå¡
      const lowerText = text.toLowerCase();
      if (lowerText.includes('autograph') || lowerText.includes('auto')) {
        document.getElementById('canDrawAuto').value = 'Y';
      }
      if (lowerText.includes('relic') || lowerText.includes('memorabilia')) {
        document.getElementById('canDrawRelic').value = 'Y';
      }
      if (lowerText.includes('parallel') || lowerText.includes('refractor')) {
        document.getElementById('canDrawSP').value = 'Y';
      }
      
      console.log('=== è§£æçµæœ ===');
      console.log('çƒå“¡:', playerName || 'æœªè­˜åˆ¥');
      console.log('å¡è™Ÿ:', cardNumber || 'æœªè­˜åˆ¥');
      console.log('5å¼µå–®åƒ¹:', price5 || 'æœªè­˜åˆ¥');
      console.log('10å¼µå–®åƒ¹:', price10 || 'æœªè­˜åˆ¥');
      console.log('================');
    }

    function roundToNearest5(num) {
      const lastDigit = num % 10;
      if (lastDigit <= 2) {
        return Math.floor(num / 10) * 10;
      } else if (lastDigit <= 7) {
        return Math.floor(num / 10) * 10 + 5;
      } else {
        return Math.ceil(num / 10) * 10;
      }
    }

    function calculatePrice(usdPrice, exchangeRate) {
      const calculated = usdPrice * exchangeRate * 1.015 + 10;
      return roundToNearest5(Math.ceil(calculated));
    }

    async function fetchFromUrl() {
      const url = document.getElementById('productUrl').value.trim();
      if (!url) {
        alert('è«‹è¼¸å…¥ç”¢å“ç¶²å€ï¼');
        return;
      }

      alert('ç”±æ–¼ç€è¦½å™¨è·¨åŸŸé™åˆ¶ï¼Œè‡ªå‹•æŠ“å–åŠŸèƒ½æš«æ™‚ç„¡æ³•ä½¿ç”¨ã€‚\n\nè«‹æ‰‹å‹•è¤‡è£½ä»¥ä¸‹è³‡è¨Šï¼š\n1. å¡è™Ÿ\n2. çƒå“¡åç¨±å’Œäº‹ä»¶æè¿°\n3. åƒ¹æ ¼ï¼ˆ5å¼µå’Œ10å¼µï¼‰\n4. ç‰¹æ®Šå¡è³‡è¨Š\n\nç„¶å¾Œå¡«å…¥ä¸‹æ–¹è¡¨å–®ã€‚');
      
      // å˜—è©¦å¾ URL æå–å¡è™Ÿ
      const cardMatch = url.match(/card[- ](\d+)/i);
      if (cardMatch) {
        document.getElementById('cardNumber').value = cardMatch[1];
      }
    }

    function addProduct() {
      const exchangeRate = parseFloat(document.getElementById('exchangeRate').value);
      const cardNumber = document.getElementById('cardNumber').value.trim();
      const price5PerCardUSD = parseFloat(document.getElementById('price5').value);
      const price10PerCardUSD = parseFloat(document.getElementById('price10').value);
      const itemName = document.getElementById('itemName').value.trim();
      const canDrawSP = document.getElementById('canDrawSP').value;
      const canDrawAuto = document.getElementById('canDrawAuto').value;
      const canDrawRelic = document.getElementById('canDrawRelic').value;
      const autoRelic = document.getElementById('autoRelic').value;

      // é©—è­‰
      if (!cardNumber || !price5PerCardUSD || !price10PerCardUSD || !itemName) {
        alert('è«‹å¡«å¯«æ‰€æœ‰å¿…å¡«æ¬„ä½ï¼');
        return;
      }

      if (!exchangeRate || exchangeRate <= 0) {
        alert('è«‹è¨­å®šæœ‰æ•ˆçš„åŒ¯ç‡ï¼');
        return;
      }

      // è¨ˆç®—å°å¹£åƒ¹æ ¼ï¼ˆå–®åƒ¹æ˜¯æ¯å¼µçš„åƒ¹æ ¼ï¼‰
      const priceTWD = calculatePrice(price5PerCardUSD, exchangeRate);
      const thresholdPriceTWD = calculatePrice(price10PerCardUSD, exchangeRate);

      // å„ªæƒ é–€æª»æ•¸é‡ = 10å¼µ
      const threshold = 10;
      // æœ€ä½é–‹åœ˜å¼µæ•¸ = 5å¼µ
      const minOrder = 5;

      const product = {
        id: ++productIdCounter,
        itemName: itemName,
        cardNumber: cardNumber,
        price5USD: price5PerCardUSD,
        price10USD: price10PerCardUSD,
        priceTWD: priceTWD,
        thresholdPriceTWD: thresholdPriceTWD,
        threshold: threshold,
        minOrder: minOrder,
        canDrawSP: canDrawSP,
        canDrawAuto: canDrawAuto,
        canDrawRelic: canDrawRelic,
        autoRelic: autoRelic,
        isOpen: 'N'
      };

      products.push(product);
      updateProductsList();
      clearInputs();
      
      document.getElementById('generateSection').style.display = 'block';
    }

    function removeProduct(id) {
      products = products.filter(p => p.id !== id);
      updateProductsList();
      
      if (products.length === 0) {
        document.getElementById('generateSection').style.display = 'none';
        document.getElementById('outputSection').style.display = 'none';
      }
    }

    function updateProductsList() {
      const container = document.getElementById('productsList');
      
      if (products.length === 0) {
        container.innerHTML = '<p style="text-align:center;color:#999;padding:20px;">å°šæœªæ–°å¢ç”¢å“</p>';
        return;
      }

      let html = '<h3 style="color: #1e3c72; margin-bottom: 15px;">ğŸ“¦ ç”¢å“åˆ—è¡¨ (' + products.length + ')</h3>';
      
      products.forEach(p => {
        html += `
          <div class="product-item">
            <div class="product-header">
              <span class="product-number">å¡è™Ÿ ${p.cardNumber}</span>
              <button class="btn btn-remove" onclick="removeProduct(${p.id})">ğŸ—‘ï¸ ç§»é™¤</button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; font-size: 14px;">
              <div><strong>å“é …ï¼š</strong>${p.itemName}</div>
              <div><strong>å–®åƒ¹ï¼š</strong>NT$ ${p.priceTWD}</div>
              <div><strong>é–€æª»åƒ¹ï¼š</strong>NT$ ${p.thresholdPriceTWD}</div>
              <div><strong>å„ªæƒ é–€æª»ï¼š</strong>${p.threshold}å¼µ</div>
              <div><strong>æœ€ä½é–‹åœ˜ï¼š</strong>${p.minOrder}å¼µ</div>
              <div><strong>SPï¼š</strong>${p.canDrawSP} | <strong>ç°½åï¼š</strong>${p.canDrawAuto} | <strong>Relicï¼š</strong>${p.canDrawRelic}</div>
            </div>
          </div>
        `;
      });

      container.innerHTML = html;
    }

    function clearInputs() {
      document.getElementById('productUrl').value = '';
      document.getElementById('cardNumber').value = '';
      document.getElementById('price5').value = '';
      document.getElementById('price10').value = '';
      document.getElementById('itemName').value = '';
      document.getElementById('canDrawSP').value = 'N';
      document.getElementById('canDrawAuto').value = 'N';
      document.getElementById('canDrawRelic').value = 'N';
      document.getElementById('autoRelic').value = 'N';
    }

    function resetAll() {
      if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰ç”¢å“å—ï¼Ÿ')) {
        products = [];
        productIdCounter = 0;
        updateProductsList();
        document.getElementById('generateSection').style.display = 'none';
        document.getElementById('outputSection').style.display = 'none';
      }
    }

    function generateTable() {
      if (products.length === 0) {
        alert('è«‹å…ˆæ–°å¢ç”¢å“ï¼');
        return;
      }

      let tableHTML = `
        <table>
          <thead>
            <tr>
              <th>å“é …</th>
              <th>å¡è™Ÿ</th>
              <th>å–®åƒ¹</th>
              <th>é–€æª»åƒ¹</th>
              <th>å„ªæƒ é–€æª»</th>
              <th>æœ€ä½é–‹åœ˜å¼µæ•¸</th>
              <th>å¯æŠ½_SP</th>
              <th>å¯æŠ½_ç°½å</th>
              <th>å¯æŠ½_Relic</th>
              <th>æŠ½_auto_relic</th>
              <th>æ˜¯å¦é–‹æ”¾</th>
            </tr>
          </thead>
          <tbody>
      `;

      products.forEach(p => {
        tableHTML += `
          <tr>
            <td style="text-align:left;">${p.itemName}</td>
            <td>${p.cardNumber}</td>
            <td>${p.priceTWD}</td>
            <td>${p.thresholdPriceTWD}</td>
            <td>${p.threshold}</td>
            <td>${p.minOrder}</td>
            <td>${p.canDrawSP}</td>
            <td>${p.canDrawAuto}</td>
            <td>${p.canDrawRelic}</td>
            <td>${p.autoRelic}</td>
            <td>${p.isOpen}</td>
          </tr>
        `;
      });

      tableHTML += `
          </tbody>
        </table>
      `;

      document.getElementById('tableOutput').innerHTML = tableHTML;
      document.getElementById('outputSection').style.display = 'block';
      document.getElementById('outputSection').scrollIntoView({ behavior: 'smooth' });
    }

    async function copyTable() {
      if (products.length === 0) {
        alert('æ²’æœ‰è³‡æ–™å¯è¤‡è£½ï¼');
        return;
      }

      // ç”Ÿæˆ TSV æ ¼å¼
      let tsvData = '';
      
      products.forEach(p => {
        tsvData += `${p.itemName}\t${p.cardNumber}\t${p.priceTWD}\t${p.thresholdPriceTWD}\t${p.threshold}\t${p.minOrder}\t${p.canDrawSP}\t${p.canDrawAuto}\t${p.canDrawRelic}\t${p.autoRelic}\t${p.isOpen}\n`;
      });

      try {
        await navigator.clipboard.writeText(tsvData);
        const successMsg = document.getElementById('successMessage');
        successMsg.style.display = 'block';
        setTimeout(() => {
          successMsg.style.display = 'none';
        }, 3000);
      } catch (err) {
        alert('è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–è¡¨æ ¼å…§å®¹è¤‡è£½');
      }
    }
  </script>
</body>
</html>
