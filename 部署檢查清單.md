# ✅ Cloudflare Worker 部署檢查清單

## 📝 部署前檢查

### 1. 檔案準備
- [x] `cloudflare-worker-complete.js` 已建立（90行，29.28 KB）
- [x] 包含所有 7 個頁面（home, entry, orders, breaks, psa, profile, about）
- [x] 包含所有 6 個 API 端點
- [x] 前端 JavaScript 功能完整
- [x] CSS 樣式已內嵌

### 2. Supabase 設定
- [ ] 已登入 Supabase Dashboard
- [ ] 已建立專案
- [ ] 已複製 SUPABASE_URL
- [ ] 已複製 SUPABASE_ANON_KEY
- [ ] 已建立 `users` 表
- [ ] 已建立 `products` 表
- [ ] 已建立 `orders` 表
- [ ] 已建立 `group_breaks` 表
- [ ] 已設定適當的 RLS 政策（或暫時停用以便測試）

### 3. Cloudflare 設定
- [ ] 已登入 Cloudflare Dashboard
- [ ] 已進入 Workers & Pages
- [ ] 已建立新 Worker 或選擇現有 Worker
- [ ] 已將 `cloudflare-worker-complete.js` 內容貼上
- [ ] 已儲存並部署

### 4. 環境變數設定
- [ ] 已在 Worker Settings → Variables 新增 `SUPABASE_URL`
- [ ] 已在 Worker Settings → Variables 新增 `SUPABASE_ANON_KEY`（類型設為 Secret）
- [ ] 已儲存變數設定

### 5. 測試項目

#### 5.1 基本功能
- [ ] 能正常訪問 Worker URL
- [ ] 首頁正常顯示
- [ ] 側邊欄能正常開啟/關閉
- [ ] 頁面切換功能正常

#### 5.2 登入功能
- [ ] 能開啟登入 Modal
- [ ] 輸入正確的手機號碼和生日能登入
- [ ] 輸入錯誤的資訊顯示錯誤提示
- [ ] 登入後顯示會員資訊
- [ ] 登入後顯示會員專屬選單
- [ ] 登出功能正常

#### 5.3 商品列表
- [ ] 商品列表正常載入
- [ ] 商品圖片正常顯示
- [ ] 商品資訊完整顯示

#### 5.4 訂單查詢（需登入）
- [ ] 訂單列表正常載入
- [ ] 「全部」篩選正常
- [ ] 「待付款」篩選正常
- [ ] 「已付款」篩選正常
- [ ] 「已出貨」篩選正常
- [ ] 訂單資訊完整顯示

#### 5.5 團拆查詢（需登入）
- [ ] 團拆列表正常載入
- [ ] 團拆資訊完整顯示

#### 5.6 PSA 鑑定（需登入）
- [ ] PSA 表單正常顯示
- [ ] Tab 切換正常（Ultra Pro / 其他）
- [ ] 選擇數量後總金額正確計算
- [ ] 表單能正常送出
- [ ] 送出後顯示成功訊息

#### 5.7 付款通知（需登入）
- [ ] 付款表單正常顯示
- [ ] 所有欄位都能正常填寫
- [ ] 表單能正常送出
- [ ] 送出後顯示成功訊息

#### 5.8 關於我們
- [ ] 關於我們頁面正常顯示
- [ ] 聯絡資訊完整

### 6. 響應式測試
- [ ] 桌面版（> 1024px）正常顯示
- [ ] 平板版（768px - 1024px）正常顯示
- [ ] 手機版（< 768px）正常顯示
- [ ] 觸控操作順暢

### 7. 自動登入測試
- [ ] 登入後重新整理頁面，仍保持登入狀態
- [ ] 7 天內重新訪問自動登入
- [ ] 超過 7 天後需重新登入

---

## 🚨 常見問題排除

### 問題 1：登入失敗
**可能原因**：
- Supabase 環境變數未正確設定
- 資料庫中沒有對應的用戶資料
- 手機號碼或生日格式錯誤

**解決方法**：
1. 檢查環境變數是否正確
2. 在 Supabase 資料庫中確認用戶資料
3. 確保手機號碼以 0 開頭，生日為 MMDD 格式

### 問題 2：商品無法顯示
**可能原因**：
- products 表中沒有資料
- is_available 欄位為 false
- API 端點錯誤

**解決方法**：
1. 在 Supabase 資料庫中新增商品資料
2. 確認 is_available = true
3. 檢查瀏覽器 Console 和 Network 標籤

### 問題 3：API 回應 404
**可能原因**：
- API 路徑錯誤
- Worker 未正確部署

**解決方法**：
1. 確認 API 路徑拼寫正確
2. 重新部署 Worker
3. 清除瀏覽器快取

### 問題 4：CORS 錯誤
**可能原因**：
- CORS 設定未正確處理
- OPTIONS 請求未正確回應

**解決方法**：
1. 檢查 handleAPI 函數中的 CORS headers
2. 確認 OPTIONS 請求有正確回應

---

## 📊 部署完成後的驗證

### 1. 基本驗證
```bash
# 測試 Worker 是否正常運作
curl https://your-worker.workers.dev

# 測試 API 端點
curl https://your-worker.workers.dev/api/products
```

### 2. 登入測試
```bash
curl -X POST https://your-worker.workers.dev/api/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"0912345678","birthday":"0115"}'
```

### 3. 效能檢查
- [ ] 首次載入時間 < 3 秒
- [ ] API 回應時間 < 1 秒
- [ ] 頁面切換流暢無延遲

---

## 🎉 部署成功標準

當以下所有項目都完成時，表示部署成功：

1. ✅ Worker URL 能正常訪問
2. ✅ 所有頁面都能正常顯示和切換
3. ✅ 登入/登出功能正常
4. ✅ 所有 API 端點都能正常回應
5. ✅ 商品、訂單、團拆資料都能正常載入
6. ✅ PSA 和付款表單都能正常送出
7. ✅ 手機版和桌面版都能正常使用
8. ✅ 自動登入功能正常

---

## 📞 需要協助？

如果遇到無法解決的問題，請：
1. 檢查瀏覽器 Console 的錯誤訊息
2. 查看 Cloudflare Workers 的 Logs
3. 確認 Supabase 的 API Logs
4. 參考 `CLOUDFLARE_WORKER_部署說明.md` 文件

---

**準備時間**: 約 30 分鐘  
**難度**: ⭐⭐⭐☆☆ (中等)

祝部署順利！🚀
