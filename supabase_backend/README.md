# Supabase å¾Œç«¯é·ç§»æŒ‡å—

## ğŸ“ æª”æ¡ˆçµæ§‹

```
supabase_backend/
â”œâ”€â”€ gas_export.js          # GAS è³‡æ–™å°å‡ºå°ˆç”¨ï¼ˆéƒ¨ç½²åˆ° Google Apps Scriptï¼‰
â”œâ”€â”€ migrate.js             # è³‡æ–™é·ç§»è…³æœ¬ï¼ˆæœ¬åœ°åŸ·è¡Œï¼‰
â”œâ”€â”€ test-gas-export.js     # æ¸¬è©¦ GAS APIï¼ˆæœ¬åœ°åŸ·è¡Œï¼‰
â”œâ”€â”€ package.json           # Node.js ä¾è³´
â”œâ”€â”€ .env.example           # ç’°å¢ƒè®Šæ•¸ç¯„ä¾‹
â””â”€â”€ README.md              # æœ¬æ–‡ä»¶
```

## ğŸš€ é·ç§»æ­¥é©Ÿ

### æ­¥é©Ÿ 1ï¼šå»ºç«‹ Supabase è³‡æ–™è¡¨

1. ç™»å…¥ [Supabase Dashboard](https://supabase.com)
2. é¸æ“‡ä½ çš„å°ˆæ¡ˆ
3. é»æ“Šå·¦å´ **SQL Editor**
4. åŸ·è¡Œ `../supabase_migration/schema.sql` çš„å…§å®¹

### æ­¥é©Ÿ 2ï¼šéƒ¨ç½² GAS å°å‡º API

1. é–‹å•Ÿ [Google Apps Script](https://script.google.com)
2. å»ºç«‹æ–°å°ˆæ¡ˆï¼Œå‘½åç‚º `Data Export`
3. å°‡ `gas_export.js` çš„å®Œæ•´å…§å®¹è²¼ä¸Š
4. é»æ“Š **éƒ¨ç½² â†’ æ–°å¢éƒ¨ç½²ä½œæ¥­**
5. é¸æ“‡ **ç¶²é æ‡‰ç”¨ç¨‹å¼**
6. è¨­å®šï¼š
   - åŸ·è¡Œèº«åˆ†ï¼š**æˆ‘**
   - å…·æœ‰æ‡‰ç”¨ç¨‹å¼å­˜å–æ¬Šçš„ä½¿ç”¨è€…ï¼š**ä»»ä½•äºº**
7. é»æ“Š **éƒ¨ç½²** ä¸¦è¤‡è£½ç¶²å€

### æ­¥é©Ÿ 3ï¼šè¨­å®šç’°å¢ƒè®Šæ•¸

1. è¤‡è£½ `.env.example` ç‚º `.env`ï¼š
   ```bash
   cd supabase_backend
   cp .env.example .env
   ```

2. ç·¨è¼¯ `.env` ä¸¦å¡«å…¥ï¼š
   ```env
   SUPABASE_URL=https://xxxxx.supabase.co
   SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
   GAS_EXPORT_URL=https://script.google.com/macros/s/YOUR_ID/exec
   ```

   **å–å¾— Supabase è³‡è¨Šï¼š**
   - ç™»å…¥ Supabase Dashboard
   - é»æ“Šå·¦å´ **Project Settings** â†’ **API**
   - è¤‡è£½ `URL` å’Œ `anon public` key

### æ­¥é©Ÿ 4ï¼šå®‰è£ä¾è³´ä¸¦æ¸¬è©¦

```bash
cd supabase_backend
npm install

# æ¸¬è©¦ GAS API æ˜¯å¦æ­£å¸¸
npm run test-gas

# å¦‚æœæ¸¬è©¦æˆåŠŸï¼ŒåŸ·è¡Œé·ç§»
npm run migrate
```

## ğŸ” æ¸¬è©¦çµæœç¯„ä¾‹

åŸ·è¡Œ `npm run test-gas` æ‡‰è©²çœ‹åˆ°ï¼š

```
ğŸ§ª æ¸¬è©¦ GAS å°å‡º API
ğŸ“ URL: https://script.google.com/...

ğŸ“¡ æ¸¬è©¦: ç”¨æˆ¶
  âœ… æˆåŠŸ! æ•¸é‡: 150
  ğŸ“ ç¬¬ä¸€ç­†ç¯„ä¾‹: {
    "phone": "0912345678",
    "nickname": "æ¸¬è©¦ç”¨æˆ¶",
    "birthday": "1990-01-01",
    ...
  }

ğŸ“¡ æ¸¬è©¦: è¨‚å–®
  âœ… æˆåŠŸ! æ•¸é‡: 523
  ...

âœ… æ¸¬è©¦å®Œæˆ
```

## âš ï¸ æ³¨æ„äº‹é …

### 1. **GAS å°å‡ºå°ˆæ¡ˆæ˜¯ç¨ç«‹çš„**
- `gas_export.js` æ˜¯ä¸€å€‹**å®Œå…¨ç¨ç«‹**çš„ GAS å°ˆæ¡ˆ
- ä¸æœƒä¿®æ”¹ç¾æœ‰çš„ `backend_test.js` æˆ– `backend.js`
- åªç”¨æ–¼ä¸€æ¬¡æ€§è³‡æ–™åŒ¯å‡º

### 2. **è³‡æ–™å®‰å…¨**
- GAS éƒ¨ç½²è¨­å®šç‚ºã€Œä»»ä½•äººã€å¯å­˜å–ï¼ˆå› ç‚ºéœ€è¦å¾æœ¬åœ°åŸ·è¡Œé·ç§»ï¼‰
- é·ç§»å®Œæˆå¾Œå¯ä»¥**åœç”¨æˆ–åˆªé™¤**é€™å€‹ GAS å°ˆæ¡ˆ
- å»ºè­°åœ¨éç‡Ÿæ¥­æ™‚é–“åŸ·è¡Œé·ç§»

### 3. **é·ç§»ç­–ç•¥**
- å…ˆåœ¨**æ¸¬è©¦ç’°å¢ƒ**åŸ·è¡Œå®Œæ•´é·ç§»
- é©—è­‰è³‡æ–™æ­£ç¢ºæ€§
- ç¢ºèªç„¡èª¤å¾Œå†é·ç§»æ­£å¼ç’°å¢ƒ

### 4. **å›é€€æ–¹æ¡ˆ**
- åŸ Google Sheets è³‡æ–™**ä¸æœƒè¢«åˆªé™¤**
- é·ç§»å¤±æ•—å¯ä»¥é‡æ–°åŸ·è¡Œ
- Supabase å¯ä»¥æ¸…ç©ºè³‡æ–™è¡¨é‡ä¾†

## ğŸ› å¸¸è¦‹å•é¡Œ

### Q: æ¸¬è©¦ GAS æ™‚å‡ºç¾ CORS éŒ¯èª¤ï¼Ÿ
A: ç¢ºèª GAS éƒ¨ç½²è¨­å®šç‚ºã€Œä»»ä½•äººã€å¯å­˜å–

### Q: Supabase æ’å…¥è³‡æ–™å¤±æ•—ï¼Ÿ
A: æª¢æŸ¥ RLS (Row Level Security) è¨­å®šï¼Œæˆ–æš«æ™‚é—œé–‰ RLS æ¸¬è©¦

### Q: é·ç§»ä¸­æ–·äº†æ€éº¼è¾¦ï¼Ÿ
A: å¯ä»¥é‡æ–°åŸ·è¡Œ `npm run migrate`ï¼Œupsert æœƒè‡ªå‹•è™•ç†é‡è¤‡è³‡æ–™

### Q: å¦‚ä½•æ¸…ç©º Supabase é‡æ–°é·ç§»ï¼Ÿ
A: åœ¨ Supabase SQL Editor åŸ·è¡Œï¼š
```sql
TRUNCATE users, orders, breaks, break_credits, payments CASCADE;
```

## ğŸ“ ä¸‹ä¸€æ­¥

é·ç§»å®Œæˆå¾Œï¼š
1. åœ¨ Supabase é©—è­‰è³‡æ–™æ­£ç¢ºæ€§
2. å»ºç«‹æ–°çš„ APIï¼ˆä½¿ç”¨ Cloudflare Workersï¼‰
3. ä¿®æ”¹å‰ç«¯é€£æ¥åˆ°æ–° API
4. é€æ­¥æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½

è©³è¦‹ `../supabase_migration/README.md`
